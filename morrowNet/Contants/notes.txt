Steps for completion of GROUNDCOVER esp (combining our BCOM groundcover file with the Vvardenfell groundcover file)

1) Generate 'Cell Name Parent' list as a point of reference, (in case any "moved cell" record doesn't have a cell name parent record already in either of the Vvardenfell or BCOM GROUNDCOVER files we are combining)
	a) Have list of Morrowind exterior "CEll" parent records (Nick to generate this)
		i.e. Region and ID

	b) Have list of BCOM exterior "CELL" parent records. (Nick to generate this)
	
	c) Overwrite Morrowind CELL parent records with BCOM CELL parent records. Name the file 'Cell Name Parent'


- -
  - -

2) Generate GROUNDCOVER file 'hm-grass-bcom-GROUNDCOVER': 
	a) generate file "Header" as follows:

    {
        "type": "Header",
        "flags": [
            0,
            0
        ],
        "version": 1.0,
        "file_type": "Esp",
        "author": "",
        "description": "BCOM Groundcover file",
        "num_objects": 1,
        "masters": [
            [
                "Morrowind.esm",
                79837557
            ],
            [
                "Tribunal.esm",
                4565686
            ],
            [
                "Bloodmoon.esm",
                9631798
            ]
        ]
    },
	
	b) generate "Static" entries as per BCOM GROUNDCOVER file (FileTwoV4)

	b) Add CELL records and subrecords from Vvardenfell-GROUNDCOVER file

3) Compare each CELL record & subrecord with BCOM GROUNDCOVER file (FileTwoV4) and overwrite Vvardenfell records and subrecords with BCOM GROUNDCOVER
- Is this based on region, id and data.grid?
- if BCOM doesn't have one that matches, do we add it as is from vardenfell?

	a) if subrecord has "deleted" appended, remove subrecord
	b) if subrecord has "moved cell" appended, move subrecord to new cell grid coordinates
		1) Check whether new cell grid coordinates already have a CELL parent record. If CELL parent record does not exist, add record from 'Cell Name Parent' reference list.
		2) remove "moved cell" entry from the moved subrecord so it is considered a newly placed object rather than an existing object from a master file being referenced.

4) Reconstruct "mast_index" and "refr_index" numbering for all CELL reference subrecords
	a) if ""mast_index": 0", keep it. if ""mast_index": [number other than zero]", replace number with a zero
	b) remove numbers from all "refr_index:" entries in CELL reference subrecords. Replace with new number count starting from 1 and increasing incrementally, starting from the top of the file to the bottom, numbered sequentially in the order they appear

5) name final output file 'hm-grass-bcom-GROUNDCOVER'

___


('Merged plugin' refers to the final output file that will be named 'hm-grass-bcom-GROUNDCOVER')

Compare CELL parent records from Vvardenfell Groundcover with BCOM Groundcover (fileTwoV4) CELL parent records:
• if "grid" coordinates match (e.g. '18, 4'), overwrite the Vvardenfell CELL parent record in its entirety with data from the corresponding BCOM Groundcover CELL parent record (I.e. "id", "data", "flags", "region", "map colour"). 

Compare Vvardenfell Groundcover CELL reference subrecords with BCOM groundcover CELL reference subrecords:
1) check mast_index of BCOM Groundcover CELL reference subrecord.
1a) if "mast_index in BCOM groundcover = 0 (meaning it is a brand new cell reference added by BCOM, not a modification of an existing Morrowind.esm cell reference),
        insert cell reference subrecord under corresponding CELL parent record in merged file.
1b)  if "mast_index" number in BCOM Groundcover cell reference subrecord corresponds to Morrowind.esm, this is a match. Move on to next step

2) if 1b is a match, check if the refr_index in BCOM Groundcover matches a cell reference subrecord in Vvardenfell Groundcover.
2a) if no identical refr_index number can be found in Vvardenfell Groundcover, throw an error message with the following format: "ERROR: Unable to merge files: 
    CELL reference refr_index [xxx] in [file name (in this case, BCOM Groundcover)] from master file [master file name (in this case, Morrowind.esm)] Groundcover plugin 
    is missing from master file. Process aborted"
2b) if refr_index matches corresponding refr_index in Vvardenfell Groundcover, this is a match. Move on to next step

3) if 1b and 2b are matches, check if CELL reference subrecord in BCOM Groundcover has "moved cell" appended to it
3a) if "moved cell", check what grid coordinates are entered after "moved cell". If grid coordinates match another CELL parent record in Vvardenfell Groundcover, 
    omit Vvardenfell Groundcover cell reference subrecord matched in steps 1b & 2b from merged file, and insert whole BCOM subrecord as-is to new CELL parent 
    subrecord in merged file
3b) if "moved cell" grid coordinates do not match another CELL parent record in Vvardenfell Groundcover, locate corresponding grid coordinates in 'Cell Name Parent' 
    reference list and insert new CELL parent record. Then, omit Vvardenfell Groundcover cell reference subrecord matched in steps 1b & 2b from merged file, 
    and move whole BCOM subrecord as-is to new CELL parent subrecord in merged file.

4) if 1b and 2 are matches, and cell reference subrecord does not have "moved cell" appended, check if subrecord has "deleted" appended to it.
4a) if "deleted", omit whole cell reference subrecord from merged file